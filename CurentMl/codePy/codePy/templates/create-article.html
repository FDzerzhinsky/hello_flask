{% extends 'base.html' %}

{% block title %}
     Форма опросного листа
{% endblock %}

{% block body %}
<div class="container" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
    <main>
    <div class="py-5 text-center">
      <h2>Форма опросного листа</h2>
      <p class="lead">Заполните поля технических требований на поставляемое оборудование.</p>
    </div>

        <div class="container">
              <div class="col-md-7 col-lg-8">
                <h4 class="mb-3">Заполнение заявки</h4>
                <form class="needs-validation" novalidate="" method="POST">
                  <div class="row g-3">

                  <div class="col12">
                      <label for="NumberList" class="form-label">Номер опросного листа</label>
                      <input type="text" class="form-control" id="NumberList" name="title" placeholder="" value="" required="">
                      <div class="invalid-feedback">
                        Укажите номер опросного листа.
                      </div>
                  </div>

                    <div class="col-sm-6">
                      <label for="firstName" class="form-label">Имя</label>
                      <input type="text" class="form-control" id="firstName" name="firstName" placeholder="" value="" required="">
                      <div class="invalid-feedback">
                        Укажите действительное имя.
                      </div>
                    </div>

                    <div class="col-sm-6">
                      <label for="lastName" class="form-label">Фамилия</label>
                      <input type="text" class="form-control" id="lastName" name="lastName" placeholder="" value="" required="">
                      <div class="invalid-feedback">
                        Укажите действительную фамилию.
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="email" class="form-label">Электронная почта</label>
                      <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com">
                      <div class="invalid-feedback">
                        Пожалуйста, введите действительный адрес электронной почты.
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="address" class="form-label">Адрес</label>
                      <input type="text" class="form-control" id="address" name="address" placeholder="Страна, Город, улица, 1234" required="">
                      <div class="invalid-feedback">
                        Пожалуйста, введите адрес.
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="support" class="form-label">Лист заполнил <span class="text-body-secondary">(Поддержка Меридиан)</span></label>
                      <input type="text" class="form-control" id="support" name="support" placeholder="" required="">
                      <div class="invalid-feedback">
                        Пожалуйста, введите адрес.
                      </div>
                    </div>

                    <h4 class="mb-3">Сведения о существующей линии (зона еденичной продукции) </h4>

                    <div class="col-12">
                      <label for="placement" class="form-label">Помещение для расположения оборудования</label>
                      <input type="text" class="form-control" id="placement" name="placement"  placeholder="" required="">
                      <div class="invalid-feedback">
                        Пожалуйста, введите название помещения.
                      </div>
                    </div>

                    <div class="col-12">
                      <label for="intro" class="form-label">Краткое описание</label>
                      <input type="text" class="form-control" id="intro" name="intro" required>
                    </div>

                    <div class="col-12">
                       <label for="text" class="form-label">Подробное описание</label>
                       <textarea class="form-control" id="text" name="text" required></textarea>
                    </div>

                <!-- Выпадающие списки -->

              <div class="col-12">
                <select id="category" name="category" onchange="updateSubcategory1()" class="form-select">
                    <option value="">Выберите тип робота</option>
                    <option value="Промышленный">Промышленный</option>
                    <option value="Коллаборативный">Коллаборативный</option>
                </select>
              </div>

              <div class="col-12">
                <select id="subcategory1" name="subcategory1" onchange="updateSubcategory2()" class="form-select">
                    <option value="">Выберите количество осей</option>
                </select>
              </div>

              <div class="col-12">
                <select id="subcategory2" name="subcategory2" onchange="updateSubcategory3()" class="form-select">
                    <option value="">Выберите производителя</option>
                </select>
              </div>

              <div class="col-12">
                <select id="subcategory3" name="subcategory3" onchange="showSelection()" class="form-select">
                    <option value="">Выберите модель робота</option>
                </select>
              </div>


                 <script>
               // Данные из Flask
                const data = {{ data|tojson }};

                function updateSubcategory1() {
                    const category = document.getElementById('category').value;
                    const sub1 = document.getElementById('subcategory1');

                    sub1.innerHTML = '<option value="">Выберите количество осей</option>';

                    if (category && data[category]) {
                        data[category]["Количество Осей"].forEach(item => {
                            const option = new Option(item, item);
                            sub1.add(option);
                        });
                    }
                }

                function updateSubcategory2() {
                    const category = document.getElementById('category').value;
                    const sub1 = document.getElementById('subcategory1').value;
                    const sub2 = document.getElementById('subcategory2');

                    sub2.innerHTML = '<option value="">Выберите производителя</option>';

                    if (category && data[category]) {
                        data[category]["Производители"].forEach(manufacturer => {
                            const option = new Option(manufacturer, manufacturer);
                            sub2.add(option);
                        });
                    }
                }

                function updateSubcategory3() {
                    const category = document.getElementById('category').value;
                    const sub2 = document.getElementById('subcategory2').value; // 1. Получаем значение производителя
                    const sub3 = document.getElementById('subcategory3');

                    sub3.innerHTML = '<option value="">Выберите модель</option>';

                    // 2. Проверяем все необходимые условия
                    if (category && sub2 && data[category] && data[category]["Модели"][sub2]) {
                        // 3. Достаём модели для конкретного производителя
                        data[category]["Модели"][sub2].forEach(model => {
                            const option = new Option(model, model);
                            sub3.add(option);
                        });
                    }
                }

                      function showSelection() {
                    const output = document.getElementById('output');
                    const [
                        category,
                        sub1,
                        sub2,
                        sub3
                    ] = ['category', 'subcategory1', 'subcategory2', 'subcategory3']
                        .map(id => document.getElementById(id).value);

                    output.innerHTML = category && sub1 && sub2 && sub3
                        ? `Вы выбрали:<br>
                            Тип: ${category}<br>
                            Оси: ${sub1}<br>
                            Производитель: ${sub2}<br>
                            Модель: ${sub3}`
                        : '';
                }

            </script>
                    <button type="submit" class="w-100 btn btn-primary btn-lg">Записать</button>
                  </div>
                </form>
              </div>
        </div>
    </main>
    </div>
{% endblock %}